{"ast":null,"code":"var _jsxFileName = \"/Users/Phil/Desktop/Web Dev/Projects/stock-screener/src/components/radarscreen/radarscreen.component.jsx\";\nimport React from 'react';\nimport ScreenHeader from '../screen-header/screen-header.component';\nimport GenerateGrid from '../generate-grid/generate-grid.component';\nimport AddColumnButton from '../add-column-button/add-column-button.component';\nimport Dropdown from '../dropdown/dropdown.component';\nimport { INTERVALS, SYMBOLS, API_TO_INDICATORS, INDICATORS_TO_API } from '../../assets/constants';\nimport './radarscreen.styles.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst permanentHeaders = ['ID', 'Symbol', 'Interval'];\nlet updateKey = null;\n\nclass RadarScreen extends React.Component {\n  constructor(_props) {\n    super(_props);\n\n    this.getHeaderTitle = () => {\n      let headerTitle = Object.keys(this.state).filter(key => this.state[key] !== null); // console.log(headerTitle)\n\n      headerTitle = headerTitle.filter(item => item !== 'ID');\n      return headerTitle;\n    };\n\n    this.fetchAndSetState = (Symbol, header, clearedState, valueRow) => {\n      const {\n        fetchRealTimeData\n      } = this.props; // map the header (= state keys) to INDICATORS_TO_API; do not include permanent headers\n\n      const apiIndicators = header.flatMap(item => permanentHeaders.includes(item) ? [] : [INDICATORS_TO_API[item]]);\n      let stateUpdates = {}; //fetch for all symbols and the apiIndicators\n\n      fetchRealTimeData(Symbol, apiIndicators).then(indicatorObject => {\n        // loop over all apiIndicators\n        apiIndicators.forEach(apiIndicator => {\n          // look up the name used for the column header (and state key)\n          const indicatorColumn = API_TO_INDICATORS[apiIndicator];\n          const updatedRows = valueRow !== undefined ? Object.assign([], this.state[indicatorColumn], {\n            [valueRow]: indicatorObject[apiIndicator][0]\n          }) : indicatorObject[apiIndicator]; // merge the result of the current indicator column with the temp state object\n\n          stateUpdates = { ...stateUpdates,\n            // [indicatorColumn]: indicatorObject[apiIndicator]\n            [indicatorColumn]: updatedRows\n          };\n        });\n        return stateUpdates;\n      }) // update state to the updated indicators and the clearedState (all unused indicators set to null)\n      .then(stateUpdates => this.setState({ ...stateUpdates,\n        ...clearedState\n      }, () => {\n        // console.log(this.getHeaderTitle())\n        localStorage.setItem('header', this.getHeaderTitle());\n        localStorage.setItem('Symbol', this.state.Symbol);\n        localStorage.setItem('Interval', this.state.Interval);\n        localStorage.setItem('ID', this.state.ID); // updateKey = '1'\n        // console.log('mounted set', updateKey, this.state)\n      }));\n    };\n\n    this.onChange = (updatedValue, headerCol, valueRow, rowAdded) => {\n      const header = this.getHeaderTitle(); //update the changed cell (Symbol, Interval)\n\n      this.setState(prevState => {\n        const columnName = header[headerCol]; //which column changed (Symbol, Interval)\n        // console.log(prevState.ID,'prevState.ID')\n\n        const maxID = Math.max(...prevState.ID);\n        return {\n          [columnName]: Object.assign([], prevState[columnName], {\n            [valueRow]: updatedValue\n          }),\n          Interval: rowAdded ? Object.assign([], prevState.Interval, {\n            [valueRow]: 'Daily'\n          }) : prevState.Interval,\n          ID: rowAdded ? Object.assign([], prevState.ID, {\n            [valueRow]: maxID + 1\n          }) : prevState.ID\n        };\n      }, //fetch the data for the entire row based on Symbol, Interval\n      () => {\n        const Symbol = new Array(this.state.Symbol[valueRow]);\n        this.fetchAndSetState(Symbol, header, {}, valueRow);\n      });\n    };\n\n    this.sortTable = event => {\n      this.setState((prevState, props) => {\n        const sortedTable = props.onSort(event, prevState);\n        return sortedTable;\n      } // , () => console.log(this.state,'sort')\n      );\n    };\n\n    this.handleColumnUpdate = names => {\n      const {\n        Symbol\n      } = this.state; // merge permanentHeaders with the updated column names\n\n      const header = [...permanentHeaders, ...names];\n      let clearedState = JSON.parse(JSON.stringify(this.state));\n      Object.keys(clearedState).forEach(key => {\n        if (!header.includes(key)) {\n          clearedState = { ...clearedState,\n            [key]: null\n          };\n        }\n      });\n      this.fetchAndSetState(Symbol, header, clearedState);\n    };\n\n    this.onRowAdd = (updatedValue, headerCol, valueRow) => this.onChange(updatedValue, headerCol, valueRow, true);\n\n    this.state = {\n      Symbol: SYMBOLS.slice(0, 5),\n      Interval: Array(5).fill(INTERVALS[0]),\n      ID: [...Array(5)].map((a, idx) => idx) // 'Last Price': Array(8).fill(0)\n\n    };\n  } // Returns all the headers based on state object keys\n\n\n  componentDidMount() {\n    let {\n      Symbol,\n      Interval,\n      ID\n    } = this.state;\n    let rehydrate = {};\n    let header;\n\n    try {\n      header = localStorage.getItem('header').split(',');\n      Symbol = localStorage.getItem('Symbol').split(',');\n      Interval = localStorage.getItem('Interval').split(',');\n      ID = localStorage.getItem('ID').split(',');\n      rehydrate = { ...rehydrate,\n        Symbol,\n        Interval,\n        ID\n      }; // console.log('rehydrate',rehydrate)\n    } catch {\n      header = this.getHeaderTitle();\n    }\n\n    this.setState(rehydrate, () => {\n      // console.log('mount h', header)\n      this.fetchAndSetState(Symbol, header);\n    });\n  }\n\n  render() {\n    const header = this.getHeaderTitle(); // passed from the withSort HOC\n\n    const {\n      sortConfig\n    } = this.props;\n    const {\n      Symbol\n    } = this.state;\n    const usedIndicators = header.flatMap(item => permanentHeaders.includes(item) ? [] : [item]);\n    updateKey = header;\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"radarscreen\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"grid-container\",\n        style: {\n          gridTemplateColumns: `10px repeat(${header.length}, 1fr) 0`,\n          gridTemplateRows: `repeat(${Symbol.length + 1}, 1fr) 0`\n        },\n        children: [/*#__PURE__*/_jsxDEV(ScreenHeader, {\n          header: header,\n          sortTable: this.sortTable,\n          sortConfig: sortConfig\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(AddColumnButton, {\n          style: {\n            gridColumn: `${header.length + 2}`\n          },\n          handleColumnUpdate: this.handleColumnUpdate,\n          usedIndicatorsDefault: usedIndicators\n        }, updateKey, false, {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(GenerateGrid, { ...this.state,\n          header: header,\n          onChange: this.onChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(Dropdown, {\n          options: SYMBOLS,\n          gridRow: Symbol.length + 2,\n          gridColumn: 1 // key={colIdx.toString()+rowIdx.toString()} \n          ,\n          onChange: this.onRowAdd,\n          customStyles: {\n            height: '30px',\n            borderBottom: '1px solid black',\n            borderLeft: '1px solid black',\n            marginLeft: '-1px'\n          },\n          className: 'add-row',\n          children: SYMBOLS[Symbol.length]\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Remove\",\n          style: {\n            gridColumn: 1,\n            gridRow: '1 / 9',\n            width: '10px',\n            // height: '40px',\n            backgroundColor: 'Blue',\n            borderRight: '1px solid black'\n          },\n          children: \"T\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 218,\n          columnNumber: 6\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 4\n    }, this);\n  }\n\n}\n\nexport default RadarScreen;","map":{"version":3,"sources":["/Users/Phil/Desktop/Web Dev/Projects/stock-screener/src/components/radarscreen/radarscreen.component.jsx"],"names":["React","ScreenHeader","GenerateGrid","AddColumnButton","Dropdown","INTERVALS","SYMBOLS","API_TO_INDICATORS","INDICATORS_TO_API","permanentHeaders","updateKey","RadarScreen","Component","constructor","props","getHeaderTitle","headerTitle","Object","keys","state","filter","key","item","fetchAndSetState","Symbol","header","clearedState","valueRow","fetchRealTimeData","apiIndicators","flatMap","includes","stateUpdates","then","indicatorObject","forEach","apiIndicator","indicatorColumn","updatedRows","undefined","assign","setState","localStorage","setItem","Interval","ID","onChange","updatedValue","headerCol","rowAdded","prevState","columnName","maxID","Math","max","Array","sortTable","event","sortedTable","onSort","handleColumnUpdate","names","JSON","parse","stringify","onRowAdd","slice","fill","map","a","idx","componentDidMount","rehydrate","getItem","split","render","sortConfig","usedIndicators","gridTemplateColumns","length","gridTemplateRows","gridColumn","height","borderBottom","borderLeft","marginLeft","gridRow","width","backgroundColor","borderRight"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,YAAP,MAAyB,0CAAzB;AACA,OAAOC,YAAP,MAAyB,0CAAzB;AACA,OAAOC,eAAP,MAA4B,kDAA5B;AAEA,OAAOC,QAAP,MAAqB,gCAArB;AAEA,SAASC,SAAT,EAAoBC,OAApB,EAA6BC,iBAA7B,EAAgDC,iBAAhD,QAAyE,wBAAzE;AAEA,OAAO,0BAAP;;AAEA,MAAMC,gBAAgB,GAAG,CAAC,IAAD,EAAO,QAAP,EAAiB,UAAjB,CAAzB;AAEA,IAAIC,SAAS,GAAG,IAAhB;;AAGA,MAAMC,WAAN,SAA0BX,KAAK,CAACY,SAAhC,CAA0C;AACzCC,EAAAA,WAAW,CAACC,MAAD,EAAQ;AAClB,UAAMA,MAAN;;AADkB,SAWnBC,cAXmB,GAWF,MAAM;AACtB,UAAIC,WAAW,GAAGC,MAAM,CAACC,IAAP,CAAY,KAAKC,KAAjB,EAAwBC,MAAxB,CAA+BC,GAAG,IAAI,KAAKF,KAAL,CAAWE,GAAX,MAAoB,IAA1D,CAAlB,CADsB,CAEtB;;AACAL,MAAAA,WAAW,GAAGA,WAAW,CAACI,MAAZ,CAAmBE,IAAI,IAAIA,IAAI,KAAK,IAApC,CAAd;AACA,aAAON,WAAP;AACA,KAhBkB;;AAAA,SAkBnBO,gBAlBmB,GAkBA,CAACC,MAAD,EAASC,MAAT,EAAiBC,YAAjB,EAA+BC,QAA/B,KAA4C;AAC9D,YAAM;AAAEC,QAAAA;AAAF,UAAwB,KAAKd,KAAnC,CAD8D,CAG9D;;AACA,YAAMe,aAAa,GAAGJ,MAAM,CAACK,OAAP,CAAeR,IAAI,IACxCb,gBAAgB,CAACsB,QAAjB,CAA0BT,IAA1B,IAAkC,EAAlC,GAAuC,CAACd,iBAAiB,CAACc,IAAD,CAAlB,CADlB,CAAtB;AAIA,UAAIU,YAAY,GAAG,EAAnB,CAR8D,CAU9D;;AACAJ,MAAAA,iBAAiB,CAACJ,MAAD,EAASK,aAAT,CAAjB,CACCI,IADD,CACMC,eAAe,IAAI;AACxB;AACAL,QAAAA,aAAa,CAACM,OAAd,CAAsBC,YAAY,IAAI;AACrC;AACA,gBAAMC,eAAe,GAAG9B,iBAAiB,CAAC6B,YAAD,CAAzC;AACA,gBAAME,WAAW,GAAGX,QAAQ,KAAGY,SAAX,GAAuBtB,MAAM,CAACuB,MAAP,CAAc,EAAd,EAAkB,KAAKrB,KAAL,CAAWkB,eAAX,CAAlB,EAA+C;AAAC,aAACV,QAAD,GAAYO,eAAe,CAACE,YAAD,CAAf,CAA8B,CAA9B;AAAb,WAA/C,CAAvB,GAAwHF,eAAe,CAACE,YAAD,CAA3J,CAHqC,CAKrC;;AACAJ,UAAAA,YAAY,GAAG,EACd,GAAGA,YADW;AAEd;AACA,aAACK,eAAD,GAAmBC;AAHL,WAAf;AAKA,SAXD;AAYA,eAAON,YAAP;AACA,OAhBD,EAiBA;AAjBA,OAkBCC,IAlBD,CAkBMD,YAAY,IAAI,KAAKS,QAAL,CAAc,EAAC,GAAGT,YAAJ;AAAiB,WAAGN;AAApB,OAAd,EAErB,MAAM;AACL;AACAgB,QAAAA,YAAY,CAACC,OAAb,CAAqB,QAArB,EAA+B,KAAK5B,cAAL,EAA/B;AACA2B,QAAAA,YAAY,CAACC,OAAb,CAAqB,QAArB,EAA+B,KAAKxB,KAAL,CAAWK,MAA1C;AACAkB,QAAAA,YAAY,CAACC,OAAb,CAAqB,UAArB,EAAiC,KAAKxB,KAAL,CAAWyB,QAA5C;AACAF,QAAAA,YAAY,CAACC,OAAb,CAAqB,IAArB,EAA2B,KAAKxB,KAAL,CAAW0B,EAAtC,EALK,CAOL;AACA;AACA,OAXoB,CAlBtB;AA+BA,KA5DkB;;AAAA,SAyFnBC,QAzFmB,GAyFR,CAACC,YAAD,EAAeC,SAAf,EAA0BrB,QAA1B,EAAoCsB,QAApC,KAAiD;AAE3D,YAAMxB,MAAM,GAAG,KAAKV,cAAL,EAAf,CAF2D,CAI3D;;AACA,WAAK0B,QAAL,CAAcS,SAAS,IAAI;AAC1B,cAAMC,UAAU,GAAG1B,MAAM,CAACuB,SAAD,CAAzB,CAD0B,CACY;AACtC;;AACA,cAAMI,KAAK,GAAGC,IAAI,CAACC,GAAL,CAAS,GAAGJ,SAAS,CAACL,EAAtB,CAAd;AACA,eAAO;AACN,WAACM,UAAD,GAAclC,MAAM,CAACuB,MAAP,CAAc,EAAd,EAAkBU,SAAS,CAACC,UAAD,CAA3B,EAAyC;AAAC,aAACxB,QAAD,GAAYoB;AAAb,WAAzC,CADR;AAENH,UAAAA,QAAQ,EAAEK,QAAQ,GAAGhC,MAAM,CAACuB,MAAP,CAAc,EAAd,EAAkBU,SAAS,CAACN,QAA5B,EAAsC;AAAC,aAACjB,QAAD,GAAY;AAAb,WAAtC,CAAH,GAAkEuB,SAAS,CAACN,QAFxF;AAGNC,UAAAA,EAAE,EAAEI,QAAQ,GAAGhC,MAAM,CAACuB,MAAP,CAAc,EAAd,EAAkBU,SAAS,CAACL,EAA5B,EAAgC;AAAC,aAAClB,QAAD,GAAYyB,KAAK,GAAC;AAAnB,WAAhC,CAAH,GAA4DF,SAAS,CAACL;AAH5E,SAAP;AAKA,OATD,EAWA;AACA,YAAM;AACL,cAAMrB,MAAM,GAAG,IAAI+B,KAAJ,CAAU,KAAKpC,KAAL,CAAWK,MAAX,CAAkBG,QAAlB,CAAV,CAAf;AACA,aAAKJ,gBAAL,CAAsBC,MAAtB,EAA8BC,MAA9B,EAAsC,EAAtC,EAA0CE,QAA1C;AACA,OAfD;AAgBA,KA9GkB;;AAAA,SAgHnB6B,SAhHmB,GAgHNC,KAAD,IAAW;AACtB,WAAKhB,QAAL,CAAc,CAACS,SAAD,EAAYpC,KAAZ,KAAsB;AACnC,cAAM4C,WAAW,GAAG5C,KAAK,CAAC6C,MAAN,CAAaF,KAAb,EAAoBP,SAApB,CAApB;AACA,eAAOQ,WAAP;AACA,OAHD,CAIA;AAJA;AAMA,KAvHkB;;AAAA,SAyHnBE,kBAzHmB,GAyHEC,KAAK,IAAI;AAC7B,YAAM;AAAErC,QAAAA;AAAF,UAAa,KAAKL,KAAxB,CAD6B,CAE7B;;AACA,YAAMM,MAAM,GAAG,CAAC,GAAGhB,gBAAJ,EAAsB,GAAGoD,KAAzB,CAAf;AAEA,UAAInC,YAAY,GAAGoC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAe,KAAK7C,KAApB,CAAX,CAAnB;AAEAF,MAAAA,MAAM,CAACC,IAAP,CAAYQ,YAAZ,EAA0BS,OAA1B,CAAkCd,GAAG,IAAI;AACxC,YAAG,CAACI,MAAM,CAACM,QAAP,CAAgBV,GAAhB,CAAJ,EAA0B;AACzBK,UAAAA,YAAY,GAAG,EACd,GAAGA,YADW;AAEd,aAACL,GAAD,GAAO;AAFO,WAAf;AAIA;AACD,OAPD;AASA,WAAKE,gBAAL,CAAsBC,MAAtB,EAA8BC,MAA9B,EAAsCC,YAAtC;AACA,KA1IkB;;AAAA,SA6InBuC,QA7ImB,GA6IR,CAAClB,YAAD,EAAeC,SAAf,EAA0BrB,QAA1B,KAAuC,KAAKmB,QAAL,CAAcC,YAAd,EAA4BC,SAA5B,EAAuCrB,QAAvC,EAAiD,IAAjD,CA7I/B;;AAElB,SAAKR,KAAL,GAAa;AACZK,MAAAA,MAAM,EAAElB,OAAO,CAAC4D,KAAR,CAAc,CAAd,EAAgB,CAAhB,CADI;AAEZtB,MAAAA,QAAQ,EAAEW,KAAK,CAAC,CAAD,CAAL,CAASY,IAAT,CAAc9D,SAAS,CAAC,CAAD,CAAvB,CAFE;AAGZwC,MAAAA,EAAE,EAAE,CAAC,GAAGU,KAAK,CAAC,CAAD,CAAT,EAAca,GAAd,CAAkB,CAACC,CAAD,EAAIC,GAAJ,KAAYA,GAA9B,CAHQ,CAIZ;;AAJY,KAAb;AAMA,GATwC,CAWzC;;;AAoDAC,EAAAA,iBAAiB,GAAG;AACnB,QAAI;AAAE/C,MAAAA,MAAF;AAAUoB,MAAAA,QAAV;AAAoBC,MAAAA;AAApB,QAA2B,KAAK1B,KAApC;AACA,QAAIqD,SAAS,GAAG,EAAhB;AACA,QAAI/C,MAAJ;;AACA,QAAI;AACHA,MAAAA,MAAM,GAAGiB,YAAY,CAAC+B,OAAb,CAAqB,QAArB,EAA+BC,KAA/B,CAAqC,GAArC,CAAT;AACAlD,MAAAA,MAAM,GAAGkB,YAAY,CAAC+B,OAAb,CAAqB,QAArB,EAA+BC,KAA/B,CAAqC,GAArC,CAAT;AACA9B,MAAAA,QAAQ,GAAGF,YAAY,CAAC+B,OAAb,CAAqB,UAArB,EAAiCC,KAAjC,CAAuC,GAAvC,CAAX;AACA7B,MAAAA,EAAE,GAAGH,YAAY,CAAC+B,OAAb,CAAqB,IAArB,EAA2BC,KAA3B,CAAiC,GAAjC,CAAL;AAEAF,MAAAA,SAAS,GAAG,EAAC,GAAGA,SAAJ;AAAehD,QAAAA,MAAf;AAAuBoB,QAAAA,QAAvB;AAAiCC,QAAAA;AAAjC,OAAZ,CANG,CAOH;AACA,KARD,CASA,MAAM;AACLpB,MAAAA,MAAM,GAAG,KAAKV,cAAL,EAAT;AACA;;AAED,SAAK0B,QAAL,CAAc+B,SAAd,EAEC,MAAM;AACL;AACA,WAAKjD,gBAAL,CAAsBC,MAAtB,EAA8BC,MAA9B;AACA,KALF;AAQA;;AAyDDkD,EAAAA,MAAM,GAAG;AACR,UAAMlD,MAAM,GAAG,KAAKV,cAAL,EAAf,CADQ,CAER;;AACA,UAAM;AAAE6D,MAAAA;AAAF,QAAiB,KAAK9D,KAA5B;AACA,UAAM;AAAEU,MAAAA;AAAF,QAAa,KAAKL,KAAxB;AAEA,UAAM0D,cAAc,GAAGpD,MAAM,CAACK,OAAP,CAAeR,IAAI,IACzCb,gBAAgB,CAACsB,QAAjB,CAA0BT,IAA1B,IAAkC,EAAlC,GAAuC,CAACA,IAAD,CADjB,CAAvB;AAIAZ,IAAAA,SAAS,GAACe,MAAV;AAEA,wBACC;AAAK,MAAA,SAAS,EAAC,aAAf;AAAA,6BACC;AAAK,QAAA,EAAE,EAAC,gBAAR;AACC,QAAA,KAAK,EAAE;AACNqD,UAAAA,mBAAmB,EAAG,eAAcrD,MAAM,CAACsD,MAAO,UAD5C;AAENC,UAAAA,gBAAgB,EAAG,UAASxD,MAAM,CAACuD,MAAP,GAAc,CAAE;AAFtC,SADR;AAAA,gCAMC,QAAC,YAAD;AACC,UAAA,MAAM,EAAEtD,MADT;AAEC,UAAA,SAAS,EAAE,KAAK+B,SAFjB;AAGC,UAAA,UAAU,EAAEoB;AAHb;AAAA;AAAA;AAAA;AAAA,gBAND,eAWC,QAAC,eAAD;AACC,UAAA,KAAK,EAAE;AACeK,YAAAA,UAAU,EAAG,GAAExD,MAAM,CAACsD,MAAP,GAAc,CAAE;AAD9C,WADR;AAIC,UAAA,kBAAkB,EAAE,KAAKnB,kBAJ1B;AAKC,UAAA,qBAAqB,EAAEiB;AALxB,WAMMnE,SANN;AAAA;AAAA;AAAA;AAAA,gBAXD,eAmBC,QAAC,YAAD,OACK,KAAKS,KADV;AAEC,UAAA,MAAM,EAAEM,MAFT;AAGC,UAAA,QAAQ,EAAE,KAAKqB;AAHhB;AAAA;AAAA;AAAA;AAAA,gBAnBD,eAyBC,QAAC,QAAD;AACC,UAAA,OAAO,EAAExC,OADV;AAEC,UAAA,OAAO,EAAEkB,MAAM,CAACuD,MAAP,GAAc,CAFxB;AAGC,UAAA,UAAU,EAAE,CAHb,CAIC;AAJD;AAKC,UAAA,QAAQ,EAAE,KAAKd,QALhB;AAMC,UAAA,YAAY,EAAE;AACbiB,YAAAA,MAAM,EAAE,MADK;AAEbC,YAAAA,YAAY,EAAE,iBAFD;AAGbC,YAAAA,UAAU,EAAE,iBAHC;AAIbC,YAAAA,UAAU,EAAE;AAJC,WANf;AAYC,UAAA,SAAS,EAAE,SAZZ;AAAA,oBAcE/E,OAAO,CAACkB,MAAM,CAACuD,MAAR;AAdT;AAAA;AAAA;AAAA;AAAA,gBAzBD,eA0CC;AAAK,UAAA,SAAS,EAAC,QAAf;AACC,UAAA,KAAK,EAAE;AACeE,YAAAA,UAAU,EAAE,CAD3B;AAENK,YAAAA,OAAO,EAAE,OAFH;AAGNC,YAAAA,KAAK,EAAE,MAHD;AAIN;AACAC,YAAAA,eAAe,EAAE,MALX;AAMNC,YAAAA,WAAW,EAAE;AANP,WADR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBA1CD;AAAA;AAAA;AAAA;AAAA;AAAA;AADD;AAAA;AAAA;AAAA;AAAA,YADD;AA4DA;;AAzNwC;;AA4N1C,eAAe9E,WAAf","sourcesContent":["import React from 'react';\nimport ScreenHeader from '../screen-header/screen-header.component';\nimport GenerateGrid from '../generate-grid/generate-grid.component';\nimport AddColumnButton from '../add-column-button/add-column-button.component';\n\nimport Dropdown from '../dropdown/dropdown.component';\n\nimport { INTERVALS, SYMBOLS, API_TO_INDICATORS, INDICATORS_TO_API } from '../../assets/constants';\n\nimport './radarscreen.styles.css';\n\nconst permanentHeaders = ['ID', 'Symbol', 'Interval'];\n\nlet updateKey = null;\n\n\nclass RadarScreen extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tSymbol: SYMBOLS.slice(0,5),\n\t\t\tInterval: Array(5).fill(INTERVALS[0]),\n\t\t\tID: [...Array(5)].map((a, idx) => idx)\n\t\t\t// 'Last Price': Array(8).fill(0)\n\t\t}\n\t}\n\n\t// Returns all the headers based on state object keys\n\tgetHeaderTitle = () => {\n\t\tlet headerTitle = Object.keys(this.state).filter(key => this.state[key] !== null);\n\t\t// console.log(headerTitle)\n\t\theaderTitle = headerTitle.filter(item => item !== 'ID')\n\t\treturn headerTitle;\n\t}\n\n\tfetchAndSetState = (Symbol, header, clearedState, valueRow) => {\n\t\tconst { fetchRealTimeData } = this.props;\n\n\t\t// map the header (= state keys) to INDICATORS_TO_API; do not include permanent headers\n\t\tconst apiIndicators = header.flatMap(item => \n\t\t\tpermanentHeaders.includes(item) ? [] : [INDICATORS_TO_API[item]]\n\t\t)\n\t\t\n\t\tlet stateUpdates = {};\n\n\t\t//fetch for all symbols and the apiIndicators\n\t\tfetchRealTimeData(Symbol, apiIndicators)\n\t\t.then(indicatorObject => {\n\t\t\t// loop over all apiIndicators\n\t\t\tapiIndicators.forEach(apiIndicator => {\n\t\t\t\t// look up the name used for the column header (and state key)\n\t\t\t\tconst indicatorColumn = API_TO_INDICATORS[apiIndicator];\n\t\t\t\tconst updatedRows = valueRow!==undefined ? Object.assign([], this.state[indicatorColumn], {[valueRow]: indicatorObject[apiIndicator][0]}) : indicatorObject[apiIndicator]\n\n\t\t\t\t// merge the result of the current indicator column with the temp state object\n\t\t\t\tstateUpdates = {\n\t\t\t\t\t...stateUpdates,\n\t\t\t\t\t// [indicatorColumn]: indicatorObject[apiIndicator]\n\t\t\t\t\t[indicatorColumn]: updatedRows\n\t\t\t\t};\n\t\t\t});\n\t\t\treturn stateUpdates\n\t\t})\n\t\t// update state to the updated indicators and the clearedState (all unused indicators set to null)\n\t\t.then(stateUpdates => this.setState({...stateUpdates,...clearedState}\n\t\t\t,\n\t\t\t() => {\n\t\t\t\t// console.log(this.getHeaderTitle())\n\t\t\t\tlocalStorage.setItem('header', this.getHeaderTitle());\n\t\t\t\tlocalStorage.setItem('Symbol', this.state.Symbol);\n\t\t\t\tlocalStorage.setItem('Interval', this.state.Interval);\n\t\t\t\tlocalStorage.setItem('ID', this.state.ID);\n\n\t\t\t\t// updateKey = '1'\n\t\t\t\t// console.log('mounted set', updateKey, this.state)\n\t\t\t}\n\t\t))\n\t}\n\n\tcomponentDidMount() {\n\t\tlet { Symbol, Interval, ID } = this.state;\n\t\tlet rehydrate = {};\n\t\tlet header;\n\t\ttry {\n\t\t\theader = localStorage.getItem('header').split(',');\n\t\t\tSymbol = localStorage.getItem('Symbol').split(',');\n\t\t\tInterval = localStorage.getItem('Interval').split(',');\n\t\t\tID = localStorage.getItem('ID').split(',');\n\n\t\t\trehydrate = {...rehydrate, Symbol, Interval, ID}\n\t\t\t// console.log('rehydrate',rehydrate)\n\t\t}\n\t\tcatch {\n\t\t\theader = this.getHeaderTitle();\n\t\t}\n\n\t\tthis.setState(rehydrate\n\t\t\t,\n\t\t\t() => {\n\t\t\t\t// console.log('mount h', header)\n\t\t\t\tthis.fetchAndSetState(Symbol, header)\n\t\t\t}\n\t\t);\n\n\t}\n\n\tonChange = (updatedValue, headerCol, valueRow, rowAdded) => {\n\n\t\tconst header = this.getHeaderTitle();\n\t\t\n\t\t//update the changed cell (Symbol, Interval)\n\t\tthis.setState(prevState => {\n\t\t\tconst columnName = header[headerCol]; //which column changed (Symbol, Interval)\n\t\t\t// console.log(prevState.ID,'prevState.ID')\n\t\t\tconst maxID = Math.max(...prevState.ID);\n\t\t\treturn {\n\t\t\t\t[columnName]: Object.assign([], prevState[columnName], {[valueRow]: updatedValue}),\n\t\t\t\tInterval: rowAdded ? Object.assign([], prevState.Interval, {[valueRow]: 'Daily'}) : prevState.Interval,\n\t\t\t\tID: rowAdded ? Object.assign([], prevState.ID, {[valueRow]: maxID+1}) : prevState.ID\n\t\t\t}\n\t\t}\n\t\t,\n\t\t//fetch the data for the entire row based on Symbol, Interval\n\t\t() => {\n\t\t\tconst Symbol = new Array(this.state.Symbol[valueRow]);\n\t\t\tthis.fetchAndSetState(Symbol, header, {}, valueRow);\n\t\t})\n\t}\n\n\tsortTable = (event) => {\n\t\tthis.setState((prevState, props) => {\n\t\t\tconst sortedTable = props.onSort(event, prevState);\n\t\t\treturn sortedTable;\n\t\t}\n\t\t// , () => console.log(this.state,'sort')\n\t\t);\n\t}\n\n\thandleColumnUpdate = names => {\n\t\tconst { Symbol } = this.state;\n\t\t// merge permanentHeaders with the updated column names\n\t\tconst header = [...permanentHeaders, ...names];\n\n\t\tlet clearedState = JSON.parse(JSON.stringify(this.state));\n\n\t\tObject.keys(clearedState).forEach(key => {\n\t\t\tif(!header.includes(key)) {\n\t\t\t\tclearedState = {\n\t\t\t\t\t...clearedState,\n\t\t\t\t\t[key]: null\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t\n\t\tthis.fetchAndSetState(Symbol, header, clearedState);\n\t}\n\n\n\tonRowAdd = (updatedValue, headerCol, valueRow) => this.onChange(updatedValue, headerCol, valueRow, true);\n\t\n\t\n\trender() {\n\t\tconst header = this.getHeaderTitle();\n\t\t// passed from the withSort HOC\n\t\tconst { sortConfig } = this.props;\n\t\tconst { Symbol } = this.state;\n\n\t\tconst usedIndicators = header.flatMap(item => \n\t\t\tpermanentHeaders.includes(item) ? [] : [item]\n\t\t);\n\n\t\tupdateKey=header;\n\t\t\n\t\treturn (\n\t\t\t<div className=\"radarscreen\">\n\t\t\t\t<div id=\"grid-container\" \n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tgridTemplateColumns: `10px repeat(${header.length}, 1fr) 0`,\n\t\t\t\t\t\tgridTemplateRows: `repeat(${Symbol.length+1}, 1fr) 0`\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<ScreenHeader \n\t\t\t\t\t\theader={header}\n\t\t\t\t\t\tsortTable={this.sortTable}\n\t\t\t\t\t\tsortConfig={sortConfig}\n\t\t\t\t\t/>\n\t\t\t\t\t<AddColumnButton \n\t\t\t\t\t\tstyle={{\n                            gridColumn: `${header.length+2}`\n                        }}\n\t\t\t\t\t\thandleColumnUpdate={this.handleColumnUpdate}\n\t\t\t\t\t\tusedIndicatorsDefault={usedIndicators}\n\t\t\t\t\t\tkey={updateKey}\n\t\t\t\t\t/>\n\t\t\t\t\t<GenerateGrid \n\t\t\t\t\t\t{...this.state}\n\t\t\t\t\t\theader={header}\n\t\t\t\t\t\tonChange={this.onChange}\n\t\t\t\t\t/>\n\n\t\t\t\t\t<Dropdown \n\t\t\t\t\t\toptions={SYMBOLS}\n\t\t\t\t\t\tgridRow={Symbol.length+2}\n\t\t\t\t\t\tgridColumn={1}\n\t\t\t\t\t\t// key={colIdx.toString()+rowIdx.toString()} \n\t\t\t\t\t\tonChange={this.onRowAdd}\n\t\t\t\t\t\tcustomStyles={{\n\t\t\t\t\t\t\theight: '30px', \n\t\t\t\t\t\t\tborderBottom: '1px solid black',\n\t\t\t\t\t\t\tborderLeft: '1px solid black',\n\t\t\t\t\t\t\tmarginLeft: '-1px'\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tclassName={'add-row'}\n                \t>\n\t\t\t\t\t\t{SYMBOLS[Symbol.length]}\n                \t</Dropdown> \n\n\t\t\t\t\t<div className='Remove'\n\t\t\t\t\t\tstyle={{\n                            gridColumn: 1,\n\t\t\t\t\t\t\tgridRow: '1 / 9',\n\t\t\t\t\t\t\twidth: '10px',\n\t\t\t\t\t\t\t// height: '40px',\n\t\t\t\t\t\t\tbackgroundColor: 'Blue',\n\t\t\t\t\t\t\tborderRight: '1px solid black'\n                        }}\n\t\t\t\t\t>\n\t\t\t\t\t\tT\n\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t</div>\n\t\t)\n\t}\n}\n\nexport default RadarScreen;"]},"metadata":{},"sourceType":"module"}